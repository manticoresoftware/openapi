openapi: 3.1.0
info:
  title: Manticore Search Client
  description: |
    Ð¡lient for Manticore Search.
  version: 4.0.0
  contact:
    name: Manticore Software Ltd.
    email: info@manticoresearch.com
    url: 'https://manticoresearch.com/contact-us/'
  license:
    name: MIT
    url: 'http://opensource.org/licenses/MIT'
tags:
  - name: Index
    description: Operations regarding adding, updating or deleting documents
  - name: Search
    description: Operations about performing searches over indexes
  - name: Utils
    description: Various operations
externalDocs:
  description: Find out more about Manticore Search
  url: 'https://manticoresearch.com/'
components:
  examples:
    objectExample:
      value: www
      summary: A sample object
  schemas:
    percolateRequest:
      type: object
      description: Object with documents to percolate
      required:
        - query
      properties:
        query:
          type: object
          additionalProperties: true
          required:
            - percolate
          properties:
            percolate:
              type: object
          example:
            percolate:
              document:
                title: some text to match
    searchResponse:
      type: object
      description: Response object of a search request
      properties:
        took:
          type: integer
        timed_out:
          type: boolean
        aggregations:
          type: object
          additionalProperties: true        
        hits:
          type: object
          properties:
            max_score:
              type: integer
            total:
              type: integer
            total_relation:
              type: string
            hits:
              type: array
              items:
                type: object

          example:
            total: 2
            hits:
              - _id: 1
                _score: 1
                _source:
                  gid: 11
              - _id: 2
                _score: 1
                _source:
                  gid: 20
        profile:
          type: object
        warning:
          type: object
          additionalProperties: true
    errorResponseError:
      oneOf:
        - type: object
          description: Detailed error information from error response
          required:
            - type
          properties:
            type: 
              type: string
            reason:
              type:
                - string
                - 'null'
            index:
              type:
                - string
                - 'null'
        - type: string
          description: Error text from error response
    errorResponse:
      type: object
      description: Error response
      required:
        - error
      properties:
        error:
          $ref: '#/components/schemas/errorResponseError'
        status:
          type: integer
          default: 500
      example:
        status: 500
        error: an error occured                
paths:
  '/pq/{index}/search':
    post:
      summary: Perform reverse search on a percolate index
      x-is_percolate: true
      operationId: percolate
      description: >
        Performs a percolate search. 
        
        This method must be used only on percolate indexes.
        

        Expects two parameters: the index name and an object with
        array of documents to be tested.

        An example of the documents object:

          ```
          {
            "query":
            {
              "percolate":
              {
                "document":
                {
                  "content":"sample content"
                }
              }
            }
          }
          ```

        Responds with an object with matched stored queries: 
        
          ```
          {
            'timed_out':false,
            'hits':
            {
              'total':2,
              'max_score':1,
              'hits':
              [
                {
                  '_index':'idx_pq_1',
                  '_type':'doc',
                  '_id':'2',
                  '_score':'1',
                  '_source':
                  {
                    'query':
                    {
                      'match':{'title':'some'}
                    }
                  }
                },
                {
                  '_index':'idx_pq_1',
                  '_type':'doc',
                  '_id':'5',
                  '_score':'1',
                  '_source':
                  {
                    'query':
                    {
                      'ql':'some | none'
                    }
                  }
                }
              ]
            }
          }
          ```
      tags:
        - Search
      externalDocs:
        url: 'https://manual.manticoresearch.com/Updating_documents/UPDATE'
      parameters:
        - in: path
          name: index
          schema:
            type: string
          required: true
          description: Name of the percolate index
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/percolateRequest'
            example:
              query:
                percolate:
                  document:
                    title: some text to match
      responses:
        '200':
          description: items found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/searchResponse'
        default:
          description: error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/errorResponse'
servers:
  - description: Default Manticore Search HTTP 
    url: http://127.0.0.1:9308/
