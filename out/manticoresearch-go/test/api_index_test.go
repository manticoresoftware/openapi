/*
Manticore Search Client

Testing IndexAPIService

*/

// Code generated by OpenAPI Generator (https://openapi-generator.tech);

package openapi

import (
	"fmt"
	"context"
	"github.com/stretchr/testify/assert"
	"github.com/stretchr/testify/require"
	"testing"
	Manticoresearch "github.com/manticoresoftware/manticoresearch-go"
)

func Test_openapi_IndexAPIService(t *testing.T) {

	configuration := Manticoresearch.NewConfiguration()
	configuration.Servers[0].URL = "http://localhost:9408"
	apiClient := Manticoresearch.NewAPIClient(configuration)

	t.Run("Test IndexAPIService Insert", func(t *testing.T) {

		sql := "DROP TABLE IF EXISTS test"
		apiClient.UtilsAPI.Sql(context.Background()).Body(sql).RawResponse(true).Execute()
		sql = "CREATE TABLE IF NOT EXISTS test(title text)"
		apiClient.UtilsAPI.Sql(context.Background()).Body(sql).RawResponse(true).Execute()
		
		indexDoc := map[string]interface{} {"title": "Test title"}
		indexReq := Manticoresearch.NewInsertDocumentRequest("test", indexDoc)
		indexReq.SetId(1)
		resp, httpRes, err := apiClient.IndexAPI.Insert(context.Background()).InsertDocumentRequest(*indexReq).Execute();
		require.Nil(t, err)
		require.NotNil(t, resp)
		assert.Equal(t, 200, httpRes.StatusCode)

		sql = "DROP TABLE IF EXISTS test"
		apiClient.UtilsAPI.Sql(context.Background()).Body(sql).RawResponse(true).Execute()

		fmt.Println("Index tests finished");
	})
}
